<!--Version 1-->
<!--This version includes the following mapping:
Map is a leaflet map with mapbox tiles.
Lines are drawn using leaflet API (hence it's styling)
Station are mapped to d3 changeStations.
line path is mapped to shape. Each line mapped to differrent color
Every relevant station (i.e. station where two lines intersect) is mapped to a circle with a text.
The best station to switch stations at has double mappings:
1. The better the station (=the shorter time), the bigger the station's icon.
 The waiting time is mapped to the circle's radius ([Max time - current time]), the bigger the better.
2. The better the station, the darker is the station's hue.
The waiting time is mapped to the circle's hue and indicated in a hover tooltip.
Coloring: the lines and the circle are 3 distinctive colors (red, blue and green). The station's colors received sequntial scaling.
Next iterations: suggestions:
- Cancel double mapping: map stations to icons and shortest waiting time to darkest hue.
- Add a legend for the waiting times
- Add a tooltip for the line
- Add origin & destination stations indication
-->
<!DOCTYPE html>
<html>
<!--import thr leaflet css-->
<link rel="stylesheet"
	href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />

<head>
<!--Script imports-->
<meta charset="utf-8" />
<link rel="stylesheet"
	href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
<script src="http://d3js.org/d3.v3.min.js" type="text/javascript"></script>
<script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
<script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.js'></script>
<!--<script src="colorbrewer.js"></script>-->
<link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.4/mapbox.css'
	rel='stylesheet' />
<!--General Styling-->
<style>
html, body {
	height: 100%;
	width: 100%;
	margin: 0;
}

#map {
	width: 100%;
	height: 100%;
}

svg {
	position: relative;
}

path {
	fill-opacity: 0;
	stroke-width: 7px;
	stroke-opacity: 0.5;
}

.stationsText {
	stroke: black;
	stroke-width: 0.1px;
	fill: #67000d;
	font-size: 10pt;
	font-weight: bold;
}

.stations {
	stroke-width: 1px;
	stroke: black;
}

.lineStations {
	fill-opacity: 0;
	stroke-opacity: 0;;
}

.legend {
	padding: 6px 8px;
	font: 14px/16px Arial, Helvetica, sans-serif;
	background: white;
	background: rgba(255, 255, 255, 0.8);
	box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
	border-radius: 5px;
	line-height: 18px;
	color: #555;
}
</style>

</head>

<body>

	<div id="map">
		<script type="text/javascript">
			//Importing the mapbox tiles layer. For our purposes, the example map is sufficient
			var mapboxTiles = L
					.tileLayer(
							'https://api.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token={token}',
							{
								attribution : 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
								mapId : 'mapbox-streets',
								token : 'pk.eyJ1Ijoic2hha2VkayIsImEiOiJjaWxjYzVxbzIwMDZud2dsejg3Zmw3dncyIn0.1mxg8ZqXNXzMZ2OkH9os5A'
							});
			//Importing the map from leaflet and adding the tiles layer.
			//The initial view is centered to Tel Aviv, according to the example info (lines 171 and 222).
			var map = L.map('map').addLayer(mapboxTiles).setView(
					[ 32.07452, 34.78875 ], 13);
			// Initialize the SVG layer
			map._initPathRoot()
			// Categorical colors for 2 lines routes and the optional changing station's colors
			var mappingColors = {
				"areaBorderColor" : "rgb(152,78,163)",
			};
			// color used for HeatMap
			var heatScheme = [ 'rgb(247,252,245)', 'rgb(229,245,224)',
					'rgb(199,233,192)', 'rgb(161,217,155)', 'rgb(116,196,118)',
					'rgb(65,171,93)', 'rgb(35,139,69)', 'rgb(0,90,50)' ];
			//Holds the hues that will be assigned for the waiting time mapping (the station changeStations color).
			//The actual setting is done after the relevant number of optional changing station is calculated.
			var stationsHues;
			// We pick up the SVG from the map object
			var svg = d3.select(map.getPanes().overlayPane).append("svg"), g = svg
					.append("g").attr("class", "leaflet-zoom-hide");
			//Styling variables used for the routes path layer
			var sAreaStyle = {
				"color" : mappingColors.areaBorderColor
			};

			//Getting the area polygons from the server
			$.ajax({
				type : "POST",
				contentType : "application/json; charset=utf-8",
				url : 'localhost:8080/areas',
				dataType : 'json',
				async : true,
				data : "{}",
				success : function(data) {
					var pos_data = data;
					draw_areas_on_map(pos_data);
				},
				error : function(result) {

				}
			})
			function draw_histogram(pos_data) {
				//Drawing the areas' paths using leaflet layer and not svg
				d3.json(pos_data, function(collection) {
					L.geoJson(collection, {
						style : sAreaStyle
					}).addTo(map);
				});
			}
			//Adding a legend with sequential horizontal bar for easy access
			var legend = L.control({
				position : 'bottomright'
			});
			legend.onAdd = function(map) {
				var div = L.DomUtil.create('div', 'legend');
				div.innerHTML += '<p style="margin:auto; background: linear-gradient(to right, '
						+ heatScheme + ')"</p>' + '<br>';
				div.innerHTML += '<p style="font-weight: bold"> longest waiting &#8596 shortest waiting</p>';
				return div;
			};
			legend.addTo(map);
			//Using SVG, iterating the stations and displaying only the
			//change stations (in this example there are only 8 stations)
		</script>
	</div>
</body>

</html>